#include <stdio.h>
#include <stdlib.h>

#define MAX 5   // Tamanho fixo da fila

/// ------------------------------------------------------------
/// Estrutura que representa uma peça do jogo
/// nome: caractere que indica o tipo ('I', 'O', 'T', 'L')
/// id: identificador único da peça
/// ------------------------------------------------------------
typedef struct {
    char nome;
    int id;
} Peca;

/// ------------------------------------------------------------
/// Estrutura da fila circular de peças
/// ------------------------------------------------------------
typedef struct {
    Peca itens[MAX];
    int frente;
    int tras;
    int quantidade;
} Fila;

/// ------------------------------------------------------------
/// Prototipação das funções
/// ------------------------------------------------------------
void inicializarFila(Fila *f);
int estaCheia(Fila *f);
int estaVazia(Fila *f);
Peca gerarPeca();
void enqueue(Fila *f, Peca p);
Peca dequeue(Fila *f);
void exibirFila(Fila *f);


/// ------------------------------------------------------------
/// Variável global para gerar IDs únicos
/// ------------------------------------------------------------
int proximoID = 0;

/// ------------------------------------------------------------
/// gerarPeca()
/// Gera automaticamente uma nova peça com tipo aleatório.
/// ------------------------------------------------------------
Peca gerarPeca() {
    char tipos[4] = {'I', 'O', 'T', 'L'};
    Peca nova;

    nova.nome = tipos[rand() % 4];
    nova.id = proximoID++;

    return nova;
}

/// ------------------------------------------------------------
/// inicializarFila()
/// Prepara a fila circular para uso.
/// ------------------------------------------------------------
void inicializarFila(Fila *f) {
    f->frente = 0;
    f->tras = -1;
    f->quantidade = 0;
}

/// ------------------------------------------------------------
/// estaCheia()
/// Retorna 1 se a fila estiver cheia.
/// ------------------------------------------------------------
int estaCheia(Fila *f) {
    return f->quantidade == MAX;
}

/// ------------------------------------------------------------
/// estaVazia()
/// Retorna 1 se a fila estiver vazia.
/// ------------------------------------------------------------
int estaVazia(Fila *f) {
    return f->quantidade == 0;
}

/// ------------------------------------------------------------
/// enqueue()
/// Insere uma nova peça no final da fila circular.
/// ------------------------------------------------------------
void enqueue(Fila *f, Peca p) {
    if (estaCheia(f)) {
        printf("A fila esta cheia! Nao e possivel adicionar nova peca.\n");
        return;
    }

    f->tras = (f->tras + 1) % MAX;
    f->itens[f->tras] = p;
    f->quantidade++;
}

/// ------------------------------------------------------------
/// dequeue()
/// Remove a peça da frente da fila e a retorna.
/// ------------------------------------------------------------
Peca dequeue(Fila *f) {
    if (estaVazia(f)) {
        printf("A fila esta vazia! Nao ha peca para jogar.\n");
        Peca vazio = {'-', -1};
        return vazio;
    }

    Peca removida = f->itens[f->frente];
    f->frente = (f->frente + 1) % MAX;
    f->quantidade--;

    return removida;
}

/// ------------------------------------------------------------
/// exibirFila()
/// Mostra a fila de peças com nome e ID.
/// ------------------------------------------------------------
void exibirFila(Fila *f) {
    printf("\nFila de pecas:\n");

    if (estaVazia(f)) {
        printf("[Vazia]\n");
        return;
    }

    int i = f->frente;

    for (int c = 0; c < f->quantidade; c++) {
        printf("[%c %d] ", f->itens[i].nome, f->itens[i].id);
        i = (i + 1) % MAX;
    }

    printf("\n");
}


/// ------------------------------------------------------------
/// main()
/// Inicializa a fila com 5 peças, exibe o menu de ações e permite
/// ao jogador manipular a fila.
/// ------------------------------------------------------------
int main() {
    Fila fila;
    inicializarFila(&fila);

    srand(42);  // Semente fixa para resultados previsíveis (opcional)

    // Inicializa a fila com 5 peças automaticamente
    for (int i = 0; i < MAX; i++) {
        enqueue(&fila, gerarPeca());
    }

    int opcao;

    printf("===== TETRIS STACK - Fila de Pecas Futuras =====\n");

    while (1) {
        exibirFila(&fila);

        printf("\nOpcoes de acao:\n");
        printf("1 - Jogar peca (dequeue)\n");
        printf("2 - Inserir nova peca (enqueue)\n");
        printf("0 - Sair\n");
        printf("Escolha: ");
        scanf("%d", &opcao);

        if (opcao == 1) {
            Peca jogada = dequeue(&fila);
            if (jogada.id != -1)
                printf("Peca jogada: [%c %d]\n", jogada.nome, jogada.id);
        }
        else if (opcao == 2) {
            enqueue(&fila, gerarPeca());
        }
        else if (opcao == 0) {
            printf("Encerrando o programa...\n");
            break;
        }
        else {
            printf("Opcao invalida! Tente novamente.\n");
        }
    }

    return 0;
}
